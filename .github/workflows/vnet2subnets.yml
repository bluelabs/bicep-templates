name: deploy-vnet-2subnet

on: [workflow_dispatch]

env:
    AZURE_RESOURCEGROUP_NAME: vnet2subnet-rg
    KEY_DATA: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqevoHGWfeY4PUcKpv61MY+or6tnlpT2BczAACP6OoaT0NMbAl1pytGyVa4r06YffzQo022f5obJBr+BRaBkfWD13S6dnVeXoQNv3qa2gQKrEPEbShFzusgI1d2zUtCr6V9Uz+Lw6wBzPCq7ARJCzK0XTDUujWpqtCqOOXidUH/HYnlkBPqC9JKIhiBlpOBLc1H0Q9d93TKRRNprLxYZNhWKAOoDEP5B9mqyilVU0kWLkUk1jtgMCE+UPZOA0LoVRv4oXibW4EyZr27zasflWMQ3nPXb2FZlhX1ZF2rMPzcZDGi7qaFx8EhKXKeIjzhFeNqJ+TauPpg/5kqw3RnaVVULv0ETiE0xSjh7P+j1M5VQ/SlF6mmqhLNVwHRljqD9bu+rzwbx81L5UliRa5T5vRQ/AUlLwvnLRRuVj3mAGG0n0GNpbnRhnLViJ3rdMo2ZTJcooIVcCb8qPXzOBtn2k59QFVicV4kQnwgny0wuhROKe18YAhQ17mn/Wap2H8CEaW8r4pA54oCYPUfhX39/uMRNtkmb0NHcsWJRvt70JTtQPAkAspiPgxlDAN41oM5x0jWLfuJo6h07urMOGHi4HKvMBluqbEhh9raX8XdRnw+MOwPyGt1MeJpzN5c6hGjAkKLXHgs2g0c8nVMFtj691+kRSBBOu8UXvcr8cZSJaHaQ== linux'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - uses: azure/arm-deploy@v1
      with:
        deploymentName: ${{ github.run_number }}
        resourceGroupName: ${{ env.AZURE_RESOURCEGROUP_NAME }}
        template: ./networking/vnet-2subnet-2nsg/main.bicep
        parameters:  adminPasswordOrKey=${{ env.KEY_DATA }}